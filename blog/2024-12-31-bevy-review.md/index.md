---
slug: bevy-review
title: bevy 후기
authors: [lsy969999]
tags: [game]
---

bevy. 베비? 비비? 베이비?  
rust 프로젝트를 찾아보는 와중에 눈에 띈 프로젝트였다.  
readme를 읽어봤는데 재미 있어 보여서 가지고 놀아봤다.

rust를 쓰지만 bevy에서 제시하는 규칙에 따라 코딩하면  
**rust의 귀찮은 borrow check를 피할수 있었다.**  
(이게 생산성에는 좋지만 혹시 rust가 궁금하거나 배우고싶어서 사용하는 사람들에게 별로일수도?)

**bevy는 전체적으로 구조가 잘 나뉘어져 있었다.**  
윈도우 생성, 렌더러, 앱 등  
bevy가 제공하는 기본 앱위에  
우리가 **plugin**을 만들어 각 기능을 추가 하면서 확장하는 구조였다.  
나는 이 구조가 마음에든다.  
각 구조를 **ECS**라는것으로 유기적으로 연결시켰다.  
bevy 대부분이 ECS위에 작성되어있다.  

나는 여기서 ECS를 처음 봤다.  
그래서 위키나 유튜브를 보면서 자료를 찾아봤는데  
데**이터 지향 설계를 구현한 아키텍쳐가 ECS** 라고 하더라.  
데이터 지향 설계란 각 데이터를 인접하게 배치해서 한번의 캐시라인으로 캐시히트비율을 높여  
성능을 높인거라고 하던데... 어렵다.  

뭐, 데이터지향 이론은 어렵긴한데 ECS 구조는 인상적이었다.  
Enity Component System,  
- 엔티티는 각 컴포넌트들의 대표 (db의 pk처럼)  
- 컴포넌트는 데이터 (db의 컬럼)  
- 시스템은 컴포넌트 의 데이터를 변경 (비지니스로직)  

마치 **데이터 베이스**를 연상시켰다.  
각 데이터를 테이블에 저장해놓고  
테이블에 쿼리를 날려서 데이터를 가져오고 저장하는  
그런부분이 ECS 와 데이터베이스 구조와 닮았다.  
처음엔 어려웠는데 DB를 연상하면서 학습하니 괜찮았다.  
그리고 ECS 기반으로 코드를 작성하는게 재미있었다.  
뭔가 뇌에 새로운 자극을주는 느낌이었다.  

bevy는 렌더링으로 wgpu 라이브러리 사용한다.  
wgpu는 **WebGPU**사양을 Rust언어로 구현한 라이브러리이다.  
WebGPU란,  
webGL(openGLES)을사용하는 웹에서  
최신 lowlevel 그래픽스라이브러리(DX12, Vulkan, Metal)를 사용하기위해  
만들어진 midlevel 그래픽스라이브러리 이다.  

즉 wgpu로 개발하면 **자동으로 DX12, Vulkan, Metal을 사용한다**.  
이는 어떤플랫폼에서 실행되는 Web환경에 알맞다.  
하지만, 굳이 웹환경이 아니더라도 사용 가능하다. 그냥 이름에 Web이 붙었을뿐 midlevel 그래픽스 라이브러리니까.  

(근데 wgpu문제인지 모르겠지만,  
안드로이드 3D 환경에서 메쉬에 카메라 Zoomin 땡기면 프레임이 상당히 떨어지는 현상이 있다. 아마 조명 문제일거같다..,  
그리고 특정 오래된 안드로이드 기기에서 깜빡이는 현상이 발생했다. ㅠㅠ)

bevy 는 wgpu에서 만든 그래픽을 그릴 창(surface)이 필요한데  
**winit** 라이브러리를 사용한다.  
winit은 rust로 만들어진 크로스플랫폼 창 생성 라이브러리이다.  
여기서 창이란, 웹에서 Canvas, 안드로이드의 SurfaceView, iOS의 MetalView 등등을 말한다.  
winit은 desktop, mobile 의 창을 다만들어준다.  

(근데, 아직 미구현과 버그들이 상당히 많았다...,   
예를들어 특정 플랫폼에서 Ime 지원이 안되고,  
cpu 사용량이 상당히 높다거나..)

bevy를 쓸때 바닐라 bevy를 사용해도 좋지만  
정말 좋은 플러그인이 많다. 대표적으로  
- bevy_asset_loading: 에셋 로딩할때 사용하는 코드 노가다를 상당히 줄여준다.  
- bevy_common_assets: Ron 이나 Json으로 변수 외부로 뺄때 사용할면 좋다.  
- bevy_inspector_egui: 사실상 현재 bevy의 에디터의 역할을 대신하는친구,  
- bevy_egui: egui라는 gui프로젝트가 있는데 그거를 bevy와 통합한것이다.  
- iyes_perf_ui: 간단한 디버그정보, fps나 현재 스폰된 entity갯수를 보여준다.  
- bevy_tweening: easing 함수가필요할때 사용함  
- bevy_crossbeam_event: FFI 코드 작성할때 사용한다. bevy 외부에서 bevy내부로 뭔가 넘겨줄때 사용.  
- bevy_hanabi: 파티클 시스템인데 아쉽게도 webgl은 지원안된다.  
- bevy_rapier: rapier 물리엔진을 bevy로 통합한거  
- avian: bevy의 ecs 스타일에 맞게 만들어진 물리엔진(새로나온거라 안정성은 별로)  
등이 있는데 플러그인들은 굉장한 노가다를 많이 줄여준다.  

(그외에 플러그인으로 뭐가 엄청 많은데 bevy 업데이트를 못따라가는 경우가 많다.)  

**bevy는 에디터가 없다.** ...  
하지만 지금 bevy가 우선으로 에디터를 개발한다고 하니 추후 버전에는 에디터가 있을거 같다.  
현재로서는 레벨 에디터 플러그인으로 개발하는것을 추천한다.  
2D 개발은 한다면 ldtk + bevy_ecs_ldtk를 추천한다. 이는 ldtk 에디터를 bevy엔진으로 통합한것이다.  
3D 개발을 한다면 blender 를 추천한다. 무료이고, bevy가 Gltf를 지원하기 때문에  
blender에서 만들어진 scene을 그대로 화면에 그려준다.  
(하지만 현재 0.15버전에서 SkinnedMesh가 잘못 컬링되는 이슈가 있긴하다.)  

**mobile은 이슈가 많다.**  
android는  
- 3d 에서 zoomin하면 fps가 떨어지는 현상  
- 터치스크린 8개이상 동시터치하면 크래시가 나는현상  
- 오래된 특정 기기에서 특정 mesh들이 깜빡이는 현상  

ios는  
- 기본 cpu 사용량 문제  
- 백그라운드에서 오래 있다가 포그라운드로 돌아오면 프리징되는형상  
- 오디오 세션이 갑자가 안되서 오디오 출력이 안된다던가  
- 핸드폰을 세로->가로로 뒤집으면 가로로 보여야되는데 세로로 보이던가  

모바일은 문제가 많았다...  
기본적으로 모바일 환경에 맞게 작성된 세이더가 없어서 발열문제에 쉽게 발생한다.  

**빌드 결과물의 크기가 크다.**  
이게 데스크탑이나 모바일은 별로 문제가 되지 않겠지만.  
웹에서는 좋지않다.  
정말 간단한앱 빌드(default features로)하면 wasm으로 20MB정도가 나오고...  
이거를 cargo release build 옵션을 조정하면 15MB정도로 줄어들고  
여기에또 wasm최적화인 binaryen 하면 한 13MB로 줄어든다.  
웹서버에서 압축해서 보내준다고하면(gzip or brotli)  
브라우저에서 5~MB 정도되는거를 받아버린다.  
프로젝트가 커지면 더 커지겠지... 이건 좋지않다.  

**업데이트가 많다.**  
3개월마다 업데이트해준다.  
많이 발전되는모습이 보여서 좋은데  
각 버전간에 마이그레이션할께 많아지기도 한다.  

**깃허브에 이슈가 엄청 많다.**  
깃허브 이슈 올리는게 귀찮은 작업인데...  
이 프로젝트에 애정을 가진 사람이 많은거같다.  




**결론**  
rust, ecs, wgpu, 등등을 학습하거나 배우고싶고  
게임 개발을 좋아하고,  
본인이 손수 어떤 기능을 만들어내는것을 좋아한다면  
정말 재미 있을것이다.  
특히 게임 오브젝트를 ecs로 생각하고 개발하는게 재미 있었다.  
하지만, 프로덕션으로 쓴다고한다면 아직은 한번더 생각해보라고 말해주고싶다.  

현재 미지원 기능들이 많지만
포텐셜을봤을때 미래가 정말 기대되는 프로젝트이다.